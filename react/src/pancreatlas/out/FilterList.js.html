<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: FilterList.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: FilterList.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @file Parent class for our list of filters--defines the sidebar and leaves implementation of individual sets to child classes
 * @author Jimmy Messmer
 */
import React from 'react'
import {
  Row,
  Col,
  Button,
  Tooltip
} from 'reactstrap'

import {
  FontAwesomeIcon
} from '@fortawesome/react-fontawesome'

import { faQuestionCircle } from '@fortawesome/free-solid-svg-icons'

import FilterSet from './FilterSet'

import {
  CheckboxFilterList,
  SliderFilterList
} from './FilterInputs'

import {
  compareAges
} from './FilterSet'

// import AgeFilterSet from './AgeFilterSet'

import Error from './Error'

/**
 * React component for the FilterList.
 * @class FilterList
 */
class FilterList extends React.Component {
  /**
   * Create a new FilterList
   * @param {*} props React props
   */
  constructor(props) {
    super(props)
    this.generateURLParam = this.generateURLParam.bind(this)
    this.setFilters = this.setFilters.bind(this)
    this.clear = this.clear.bind(this)
    this.toggle = this.toggle.bind(this)
    this.state = {
      loaded: false,
      filters: this.props.filters,
      prevFilters: this.props.filters,
      clear: true,
      ttOpen: false
    }
  }

  componentDidMount() {
    this.setState({
      loaded: true,
      tags: this.props.filters
    })
  }

  componentDidUpdate(prevProps, prevState) {
    if (JSON.stringify(prevState.filters) !== JSON.stringify(this.props.filters)) {
      this.setState({
        filters: this.props.filters
      })
    }
  }

  /**
   * Read the current URL search parameters and if the new tag is there, remove it. Otherwise, add it.
   * @param {string} newTag Tag to add
   */
  generateURLParam(newTag) {
    let params = new URLSearchParams(window.location.search)
    if (params.has('filters')) {
      var activeFilters = JSON.parse(window.atob(params.get('filters')))
      if (activeFilters.includes(newTag)) {
        activeFilters = activeFilters.filter(tag => tag !== newTag)
      } else {
        activeFilters.push(newTag)
      }
      return activeFilters
    } else {
      var newFilters = [newTag]
      return newFilters
    }
  }

  /**
   * Generate an updated list of active tags and store that in the URL. Then call the callback method in ImageGrid to propogate changes.
   * @param {array} newTags Array of new tags to add
   */
  setFilters(newTags) {
    let newParams = []
    for (let newTag of newTags) {
      /* eslint-disable no-loop-func */
      newParams = newParams.concat(this.generateURLParam(newTag).filter(param => !newParams.includes(param)))
      /* eslint-enable no-loop-func */
    }
    let encoded = window.btoa(JSON.stringify(newParams))
    let params = new URLSearchParams(window.location.search)
    params.set('filters', encoded)
    window.history.pushState({ 'pageTitle': 'Browse &amp; Filter Dataset' }, '', `${window.location.protocol}//${window.location.host}${window.location.pathname}?${params.toString()}`)
    this.props.callback(newTags)
  }

  /**
   * Clear all active filters.
   */
  clear() {
    this.props.clear({})
  }

  toggle() {
    this.setState({
      ttOpen: !this.state.ttOpen
    })
  }

  render() {
    if (this.props.tags !== null) {
      return (
        &lt;div className='filter-list'>
          &lt;Row className='pancreatlas-row'>
            &lt;Col className='text-left' md='8'>
              &lt;h3>
                &lt;strong>Filters:&lt;/strong>
              &lt;/h3>
              &lt;span id='QuestionCircle'>
                &lt;FontAwesomeIcon icon={faQuestionCircle} />
              &lt;/span>
              &lt;Tooltip placement='right'
                isOpen={this.state.ttOpen}
                target='QuestionCircle'
                toggle={this.toggle}>
                The filters work as an AND function between groups and an OR within them. Example: (Childhood) AND (F OR M)
              &lt;/Tooltip>

            &lt;/Col>
            &lt;Col className='text-right' md='4'>
              &lt;Button outline className='filter-button text-center' color='danger' size='sm' onClick={this.clear}>&lt;i
                className='fa fa-home fa-fw' />Clear&lt;/Button>
            &lt;/Col>
          &lt;/Row>
          {this.props.filters.children.map(filterSet => {
            switch (filterSet.filterMethod) {
              case 'slider':
                var ageSortedTags = filterSet.children.sort((a, b) => compareAges(a.name, b.name))
                return (
                  &lt;FilterSet setName={filterSet.name}>
                    &lt;SliderFilterList clear={this.state.clear} className='slider-filter-set' setName={filterSet.name} tags={ageSortedTags} callback={this.setFilters} key={filterSet.name} filters={[]} />
                  &lt;/FilterSet>
                )
              case 'checkbox':
              default:
                var sortedTags = filterSet.children.sort((a, b) => (a.name > b.name) ? 1 : -1)
                return (
                  &lt;FilterSet setName={filterSet.name}>
                    &lt;CheckboxFilterList clear={this.state.clear} classname='filter-set' setName={filterSet.name} tags={sortedTags} callback={this.setFilters} key={filterSet.name} filters={[]} />
                  &lt;/FilterSet>)
            }
          })}
        &lt;/div>
      )
    } else if (this.state.error !== undefined) {
      return &lt;Error error_desc={this.state.error.message} />
    } else {
      return null
    }
  }
}

FilterList.defaultProps = {
  filters: ['filter 1', 'filter 2', 'filter 3', 'filter 4'],
  tags: {}
}

export default FilterList
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="FilterList.html">FilterList</a></li><li><a href="FilterNode.html">FilterNode</a></li><li><a href="FilterTree.html">FilterTree</a></li><li><a href="SliderFilterList.html">SliderFilterList</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.3</a> on Thu Nov 28 2019 11:34:49 GMT-0600 (Central Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
